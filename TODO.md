TODO1
посмотреть можно ли как-то сгерерить функцию по описанию pipeline
чтобы пропустить этап формирования кода через сложные вызовы

ведь все просто

принимать promises в качестве параметров

moving to ZOD + ts 4.9

ВСЯ внутренняя работа идет ТОЛЬКО с Context

все параметры по внешним функциям идут ТОЛЬКО через Context

отличаем внешние от внутренних
и stageRun и прочее

размер стека???!!! что с ним делать

если есть
split T->R
тогда два параметра
combine R->T
validate R

добавить fluent pipeline так методы будут легче распознавать типы

- так сделать в trpc.js

убрать instanceof XXX сравнения, эти классы компилятся в ecmascript-5 а так нет таких штук!!! просто придумать как сделать и заменить эти хрени

компиляция в ES5 сделана для совместимости

убрать систему callback и оставить только promise !!!!

для синхронных вызовов использовать
Promise.AllSettled Promise.resolve(значение)

Посмотреть все TODO!!!
работать по тестам

к чему идем!
запрет использования constructor + только через builder!
все тесты только через него!!!

сначала упростить! потом подключить ZOD на все параметры конфига чтобы валидировать

шаг 1
[x] combine должны возвращать результат!!!
[x] split должен возвращать результат
[x] validate должен быть очень простым!!! никаких множества вариантов принимает контектс возвращает MaybePromise<boolean>
run MaybePromise(output)

если run вываливается с ошибкой и нет rescue то контекст и не нужен

- ifelse
- multiwayswitch
- doWhile
- retry

rescue должен быть простым и быть как можно ближе к stage

- похоже rescue не нужна совсем?(мысли)
- нужна для экстренных вещей, используется в Transaction!!! для сбора информации об ошибках

stage function должена принимать контекст и возврашать значение
metable immutable это решение за программистом, он сам выбирает как ему быть

возможно context как таковой не нужен, тогда и не нужно его передавать и обертку делать context внутри
все операции можно делать средствами JS
-- эта штука активно исползуется в web

сложность, что должна быть точка сборки контекста!!! это не из коробки и это должно быть как-то обыграно
поскольку не мутабельный объект не меняется поэтому нужно четко отслеживать точку сборки общего контекста

ВОЗМОЖНО!!! нужно будет сделать Override Class
что бы можно было запускать Stage через new
--- пример есть в Model Import/Export - где модель создается динамически

Input + Output

(Input) => MaybePromise<Output>

Input + !Output

(Input) => MaybePromise<void>

!Input + !Output

no run

использовать везде Promise

никаких callback!!!

всю внутренню кухню только сделать на Promise allSellted!
